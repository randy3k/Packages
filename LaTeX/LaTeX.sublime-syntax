%YAML 1.2
---
# http://www.sublimetext.com/docs/3/syntax.html
name: LaTeX
file_extensions:
  - tex
  - ltx
scope: text.tex.latex
contexts:
  prototype:
    - include: comments

  main:
    - include: unique-latex
    # external packages
    - include: packages
    - include: plain-tex
    - include: begin-end-commands
    - include: general-commands
    - include: global-braces

  unique-latex:
    - include: preamble
    - include: structure
    - include: includes
    - include: sections
    - include: text-decorators
    - include: references
    - include: verbatim
    - include: verb
    - include: url
    - include: invalid-quotations
    - include: lists

  plain-tex:
    # extended from tex
    - include: macros
    - include: scope:text.tex#controls
    - include: scope:text.tex#catcode
    - include: boxes
    - include: block-math
    - include: inline-math
    - include: general-constants

  comments:
    - include: scope:text.tex#comments

  global-braces:
    - match: '\{'
      scope: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.group.braces.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: main

  # these are used to identify arguments in commands
  general-optional-arguments:
    - match: '\['
      scope: punctuation.definition.bracket.begin.latex
      push:
        - meta_scope: meta.group.argument.optional.latex
        - match: '\]'
          scope: punctuation.definition.bracket.end.latex
          pop: true
        - include: general-constants
        - include: general-commands

  _general-1-more-argument:
    - match: '\}'
      scope: punctuation.definition.brace.end.latex
      set:
        - match: '\{'
          scope: punctuation.definition.brace.begin.latex
          push:
            - meta_scope: meta.group.argument.latex
            - match: '(?=\})'
              pop: true
            - include: main
        - match: '(?=\})'
          pop: true

  _general-2-more-arguments:
    - match: '\}'
      scope: punctuation.definition.brace.end.latex
      set:
        - match: '\{'
          scope: punctuation.definition.brace.begin.latex
          push:
            - meta_scope: meta.group.argument.latex
            - include: _general-1-more-argument
            - match: '(?=\})'
              pop: true
            - include: main
        - match: '(?=\})'
          pop: true

  general-1-argument:
    - match: '\}'
      scope: meta.group.argument.latex punctuation.definition.brace.end.latex
      pop: true
    - match: '\{'
      scope: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.group.argument.latex
        - match: '(?=\})'
          pop: true
        - include: main

  general-2-arguments:
    - match: '\}'
      scope: meta.group.argument.latex punctuation.definition.brace.end.latex
      pop: true
    - match: '\{'
      scope: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.group.argument.latex
        - include: _general-1-more-argument
        - include: main

  general-3-arguments:
    - match: '\}'
      scope: meta.group.argument.latex punctuation.definition.brace.end.latex
      pop: true
    - match: '\{'
      scope: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.group.argument.latex
        - include: _general-2-more-arguments
        - include: main

  general-1-argument-with-options:
    - include: general-optional-arguments
    - include: general-1-argument

  general-2-arguments-with-options:
    - include: general-optional-arguments
    - include: general-2-arguments

  general-3-arguments-with-options:
    - include: general-optional-arguments
    - include: general-3-arguments

  # used in macros to prevent matching of \begin{env}...\end{env}
  macro-braces:
    - match: '\{'
      scope: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.group.braces.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: general-constants
        - include: general-commands
        - include: macro-braces

  macros:
    - include: scope:text.tex#macros
    - match: |-
        (?x)
        (
          (\\)
          (?:(?:re)?newcommand)
        )
        (?:
          (\{)(\\[[:alpha:]@]+)(\})
          | (\\[[:alpha:]@])+
        )
        (?:(\[)(?:[^\]]*)(\]))?
        (\{)
      captures:
        1: support.function.newcommand.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: support.function.latex
        5: punctuation.definition.brace.end.latex
        6: support.function.latex
        7: punctuation.definition.bracket.begin.latex
        8: punctuation.definition.bracket.end.latex
        9: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.function.newcommand.tex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: general-constants
        - include: general-commands
        - include: macro-braces

  general-constants:
    - match: '(\\\\)(?:(\[)\s*-?([[:digit:]]*)\s*(\w*)\s*(\]))?'
      captures:
        1: constant.character.newline.latex
        2: punctuation.definition.bracket.begin.newline.latex
        3: constant.numeric.newline.latex
        4: keyword.other.newline.latex
        5: punctuation.definition.bracket.begin.newline.latex
    - include: scope:text.tex#general-constants

  general-commands:
    - match: '(\\)[[:alpha:]@]+'
      scope: support.function.general.latex
      captures:
        1: punctuation.definition.backslash.latex

  boxes:
    - match: '((\\)[hvmf]box)\s*(\{)'
      captures:
        1: support.function.box.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.function.box.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: main
    - match: '((\\)(?:framebox|makebox))(?=(?:\[[^\]]*?\])*\{)'
      captures:
        1: support.function.box.latex
        2: punctuation.definition.backslash.latex
      push:
        - meta_scope: meta.function.box.latex
        - include: general-1-argument-with-options
    - match: '((\\)parbox)(?=(?:\[[^\]]*?\])*(?:\{[^\}]*\}){2})'
      captures:
        1: support.function.box.latex
        2: punctuation.definition.backslash.latex
      push:
        - meta_scope: meta.function.box.latex
        - include: general-2-arguments-with-options
    - match: '((\\)raisebox)(?=(?:\[[^\]]*?\])*\{)'
      captures:
        1: support.function.box.latex
        2: punctuation.definition.backslash.latex
      push:
        - meta_scope: meta.function.box.latex
        - include: general-1-argument-with-options

  preamble:
    - match: '((\\)(?:documentclass|usepackage))\s*(?:(\[)(?:[^\]]*)(\]))?(\{)'
      captures:
        1: keyword.control.preamble.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.bracket.begin.latex
        4: punctuation.definition.bracket.end.latex
        5: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.preamble.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true

  includes:
    - match: '((\\)(?:include|includeonly))(\{)'
      scope: meta.function.include.latex
      captures:
        1: keyword.control.include.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.include.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true

  sections:
    - match: |-
        (?x)
        (
          (\\)
          (?:
            (?:sub){0,2}section
            | (?:sub)?paragraph
            | chapter|part|addpart
            | addchap|addsec|minisec
          )
          (?:\*)?
        )
        (?:
          (\[)([^\[]*?)(\])               # optional Title
        )?
        (\{)
      captures:
        1: support.function.section.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: entity.name.section.latex
        5: punctuation.definition.brace.end.latex
        6: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.section.latex
        - meta_content_scope: entity.name.section.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: main

  structure:
    - match: ((\\)(?:frontmatter|mainmatter|backmatter|appendix|printindex))\b
      captures:
        1: keyword.control.latex
        2: punctuation.definition.backslash.latex

  verbatim:
    - match: '((\\)begin)(\{)\s*((?:[vV]erbatim|alltt)\*?)\s*(\})'
      captures:
        1: support.function.be.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.bebgin.latex
        4: variable.parameter.function.latex
        5: punctuation.definition.brace.end.latex
      push:
        - meta_include_prototype: false
        - meta_scope: meta.environment.verbatim.verbatim.latex
        - meta_content_scope: markup.raw.verbatim.latex
        - match: '((\\)end)(\{)\s*(\4)\s*(\})'
          captures:
            1: support.function.be.latex
            2: punctuation.definition.backslash.latex
            3: punctuation.definition.brace.begin.latex
            4: variable.parameter.function.latex
            5: punctuation.definition.brace.end.latex
          pop: true

  lists:
    - match: '((\\)begin)(\{)\s*(itemize\*?)\s*(\})'
      captures:
        1: support.function.be.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: variable.parameter.function.latex
        5: punctuation.definition.brace.end.latex
      push:
        - meta_scope: meta.environment.list.itemize.latex
        - match: '((\\)end)(\{)\s*(\4)\s*(\})'
          captures:
            1: support.function.be.latex
            2: punctuation.definition.backslash.latex
            3: punctuation.definition.brace.begin.latex
            4: variable.parameter.function.latex
            5: punctuation.definition.brace.end.latex
          pop: true
        - include: main
    - match: '((\\)begin)(\{)\s*(enumerate\*?)\s*(\})'
      captures:
        1: support.function.be.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: variable.parameter.function.latex
        5: punctuation.definition.brace.end.latex
      push:
        - meta_scope: meta.environment.list.enumerate.latex
        - match: '((\\)end)(\{)\s*(\4)\s*(\})'
          captures:
            1: support.function.be.latex
            2: punctuation.definition.backslash.latex
            3: punctuation.definition.brace.begin.latex
            4: variable.parameter.function.latex
            5: punctuation.definition.brace.end.latex
          pop: true
        - include: main
    - match: '((\\)begin)(\{)\s*(list\*?)\s*(\})'
      captures:
        1: support.function.be.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: variable.parameter.function.latex
        5: punctuation.definition.brace.end.latex
      push:
        - meta_scope: meta.environment.list.list.latex
        - match: '((\\)end)(\{)\s*(\4)\s*(\})'
          captures:
            1: support.function.be.latex
            2: punctuation.definition.backslash.latex
            3: punctuation.definition.brace.begin.latex
            4: variable.parameter.function.latex
            5: punctuation.definition.brace.end.latex
          pop: true
        - include: main
    - match: '((\\)begin)(\{)\s*(description\*?)\s*(\})'
      captures:
        1: support.function.be.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: variable.parameter.function.latex
        5: punctuation.definition.brace.end.latex
      push:
        - meta_scope: meta.environment.list.description.latex
        - match: '((\\)end)(\{)\s*(\4)\s*(\})'
          captures:
            1: support.function.be.latex
            2: punctuation.definition.backslash.latex
            3: punctuation.definition.brace.begin.latex
            4: variable.parameter.function.latex
            5: punctuation.definition.brace.end.latex
          pop: true
        - include: main

  math-braces:
    - match: '\{'
      scope: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.group.braces.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: math-content

  math-content:
    # unique to latex
    - include: verb
    - include: text-decorators
    - include: references
    - include: begin-end-commands
    # extended from tex
    - include: scope:text.tex#greeks
    - include: scope:text.tex#math-brackets
    - include: math-braces
    - include: boxes
    - include: scope:text.tex#math-commands
    - include: scope:text.tex#math-operators
    - include: scope:text.tex#math-characters
    - include: scope:text.tex#math-numerics
    - include: general-constants

  inline-math:
    - match: \$
      scope: string.other.math.latex punctuation.definition.string.begin.latex
      push:
        - meta_scope: meta.environment.math.latex
        - match: \$
          scope: string.other.math.latex punctuation.definition.string.end.latex
          pop: true
        - include: math-content
    - match: '((\\)ensuremath)(\{)'
      captures:
        1: support.function.ensuremath.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.function.ensuremath.latex
        - meta_content_scope: meta.environment.math.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: math-content

  block-math:
    - match: \$\$
      scope: string.other.math.latex punctuation.definition.string.begin.latex
      push:
        - meta_scope: meta.environment.math.latex
        - match: \$\$
          scope: string.other.math.latex punctuation.definition.string.end.latex
          pop: true
        - include: math-content

    - match: '(\\\[)'
      scope: string.other.math.latex punctuation.definition.string.begin.latex
      push:
        - meta_scope: meta.environment.math.latex
        - match: '(\\\])'
          scope: string.other.math.latex punctuation.definition.string.end.latex
          pop: true
        - include: math-content

    - match: (\\\()
      scope: string.other.math.latex
      captures:
        1: punctuation.definition.string.begin.latex
      push:
        - meta_scope: meta.environment.math.latex
        - match: (\\\))
          scope: string.other.math.latex punctuation.definition.string.end.latex
          pop: true
        - include: math-content

    - match: '((\\)begin)(\{)\s*((?:align|alignat|aligned|alignedat|displaymath|displaymath|eqnarray|equation|flalign|gather|gathered|math|multline|xalignat)\*?)\s*(\})'
      captures:
        1: support.function.be.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: variable.parameter.function.latex
        5: punctuation.definition.brace.end.latex
      push:
        - meta_scope: meta.environment.math.latex
        - match: '((\\)end)(\{)\s*(\4)\s*(\})'
          captures:
            1: support.function.be.latex
            2: punctuation.definition.backslash.latex
            3: punctuation.definition.brace.begin.latex
            4: variable.parameter.function.latex
            5: punctuation.definition.brace.end.latex
          pop: true
        - include: math-content

  url:
    - match: '(?:\s*)((\\)(?:url|href))(\{)([^}]*)(\})'
      scope: meta.function.link.url.latex
      captures:
        1: support.function.url.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: markup.underline.link.latex
        5: punctuation.definition.brace.end.latex

  invalid-quotations:
    - match: "(?:^|[^\\S])('.*?')"
      captures:
        1: invalid.illegal.string.quoted.single.latex
    - match: '(?:^|[^\\S])(".*?")'
      captures:
        1: invalid.illegal.string.quoted.single.latex

  verb:
    - match: ((\\)verb)(\W)
      captures:
        1: support.function.verb.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.verb.latex
      push:
        - meta_scope: meta.environment.verbatim.verb.latex
        - meta_content_scope: markup.raw.verb.latex
        - match: '\3'
          scope: punctuation.definition.verb.latex
          pop: true


  text-decorators:
    - match: '((\\)emph)(\{)'
      captures:
        1: support.function.emph.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.function.emph.latex
        - meta_content_scope: markup.italic.emph.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: main
    - match: '((\\)textit)(\{)'
      captures:
        1: support.function.textit.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.function.textit.latex
        - meta_content_scope: markup.italic.textit.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: main
    - match: '((\\)textbf)(\{)'
      captures:
        1: support.function.textbf.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.function.textbf.latex
        - meta_content_scope: markup.bold.textbf.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: main
    - match: '((\\)texttt)(\{)'
      captures:
        1: support.function.texttt.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.function.texttt.latex
        - meta_content_scope: markup.raw.texttt.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: main
    - match: '((\\)textsl)(\{)'
      captures:
        1: support.function.textsl.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.function.textsl.latex
        - meta_content_scope: markup.italic.textsl.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: main
    - match: '((\\)text)(\{)'
      captures:
        1: support.function.text.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
      push:
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: main
    - match: '((\\)underline)(\{)'
      captures:
        1: support.function.text.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.function.underline.latex
        - meta_content_scope: markup.underline.underline.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: main

  references:
    - match: '((\\)(?:[cC]ite(?:author|title|year|date|url)?|(?:[pP]aren|foot|[tT]ext|[sS]mart|super|[aA]|no|full|footfull)cite|footcitetext)\*?)(?=(?:\[[^\]]*?\])*\{)'
      captures:
        1: support.function.cite.latex
        2: punctuation.definition.backslash.latex
      push:
        - meta_scope: meta.function.citation.latex
        - include: general-1-argument-with-options
    - match: '((\\)(?:eq|c?page|[vV]|auto|name|[cC])?ref\*?)(?=(?:\[[^\]]*?\])*\{)'
      captures:
        1: support.function.reference.latex
        2: punctuation.definition.backslash.latex
      push:
        - meta_scope: meta.function.reference.latex
          include: general-1-argument-with-options
    - match: '((\\)label)(\{)'
      captures:
        1: support.function.label.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.function.label.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true

  begin-end-commands:
    - match: '((\\)begin)(\{)\s*(\w*)\*?\s*(\})'
      captures:
        1: support.function.be.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: variable.parameter.function.latex
        5: punctuation.definition.brace.end.latex
      push:
        - include: general-optional-arguments
        - match: ''
          pop: true
    - match: '((\\)end)(\{)\s*(\w*)\*?\s*(\})'
      captures:
        1: support.function.be.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: variable.parameter.function.latex
        5: punctuation.definition.brace.end.latex

  # external packages
  packages:
    - include: pkglistings
    - include: minted
    - include: pkgcomment
    - include: beamer

  # listings package
  pkglistings:
    - match: ((\\)lstinline)(\W)
      captures:
        1: support.function.lstinline.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.verb.latex
      push:
        - meta_scope: meta.environment.verbatim.lstinline.latex
        - meta_content_scope: markup.raw.verb.latex
        - match: '\3'
          scope: punctuation.definition.verb.latex
          pop: true

    - match: ((\\)begin)(\{)(lstlisting)(\})
      captures:
        1: support.function.be.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: variable.parameter.function.latex
        5: punctuation.definition.brace.end.latex
      push:
        - meta_include_prototype: false
        - meta_scope: meta.environment.verbatim.lstlisting.latex
        - match: '((\\)end)(\{)(lstlisting)(\})'
          captures:
            1: support.function.be.latex
            2: punctuation.definition.backslash.latex
            3: punctuation.definition.brace.begin.latex
            4: variable.parameter.function.latex
            5: punctuation.definition.brace.end.latex
          pop: true
        - include: general-optional-arguments
        - match: '.*(%\s*(?i:python|py))$'
          captures:
            1: comment.line.percentage.latex
          push:
            - meta_include_prototype: false
            - meta_scope: meta.environment.embedded.python.latex
            - meta_content_scope: source.python.embedded
            - match: '(?=\\end\{lstlisting\})'
              pop: true
            - include: scope:source.python
        - match: '.*(%\s*(?i:java))$'
          captures:
            1: comment.line.percentage.latex
          push:
            - meta_include_prototype: false
            - meta_scope: meta.environment.embedded.java.latex
            - meta_content_scope: source.java.embedded
            - match: '(?=\\end\{lstlisting\})'
              pop: true
            - include: scope:source.java
        - match: ''
          push:
            - match: '(?=\\end\{lstlisting\})'
              pop: true

  minted:
    - match: ((\\)begin)(\{)(minted)(\})
      captures:
        1: support.function.be.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: variable.parameter.function.latex
        5: punctuation.definition.brace.end.latex
      push:
        - meta_include_prototype: false
        - meta_scope: meta.environment.verbatim.minted.latex
        - match: '((\\)end)(\{)(minted)(\})'
          captures:
            1: support.function.be.latex
            2: punctuation.definition.backslash.latex
            3: punctuation.definition.brace.begin.latex
            4: variable.parameter.function.latex
            5: punctuation.definition.brace.end.latex
          pop: true
        - include: general-optional-arguments
        - match: '\{python\}'
          push:
            - meta_include_prototype: false
            - meta_scope: meta.environment.embedded.python.latex
            - meta_content_scope: source.python.embedded
            - match: '(?=\\end\{minted\})'
              pop: true
            - include: scope:source.python
        - match: '\{java\}'
          captures:
            1: comment.line.percentage.latex
          push:
            - meta_include_prototype: false
            - meta_scope: meta.environment.embedded.java.latex
            - meta_content_scope: source.java.embedded
            - match: '(?=\\end\{minted\})'
              pop: true
            - include: scope:source.java
        - match: ''
          push:
            - match: '(?=\\end\{minted\})'
              pop: true

  # comment package
  pkgcomment:
    - match: '^(\\)comment'
      captures:
        0: punctuation.definition.comment.start.latex
        1: punctuation.definition.backslash.latex
      push:
        - meta_scope: meta.environment.comment.latex comment.block.command.comment.latex
        - match: '^(\\)endcomment'
          captures:
            0: punctuation.definition.comment.end.latex
            1: punctuation.definition.backslash.latex
          pop: true
    - match: '((\\)begin)(\{)\s*(comment)\s*(\})'
      captures:
        1: support.function.be.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: variable.parameter.function.latex
        5: punctuation.definition.brace.end.latex
      push:
        - meta_scope: meta.environment.comment.latex
        - meta_content_scope: comment.block.environment.comment.latex
        - match: '((\\)end)(\{)\s*(comment)\s*(\})'
          captures:
            1: support.function.be.latex
            2: punctuation.definition.backslash.latex
            3: punctuation.definition.brace.begin.latex
            4: variable.parameter.function.latex
            5: punctuation.definition.brace.end.latex
          pop: true

  # beamer support
  beamer:
    - match: '(?:\s*)((\\)begin)(\{)(frame)(\})'
      captures:
        1: support.function.be.latex
        2: punctuation.definition.backslash.latex
        3: punctuation.definition.brace.begin.latex
        4: variable.parameter.function.latex
        5: punctuation.definition.brace.end.latex
      push:
        - meta_scope: meta.environment.frame.latex
        - match: '((\\)end)(\{)(frame)(\})'
          captures:
            1: support.function.be.latex
            2: punctuation.definition.backslash.latex
            3: punctuation.definition.brace.begin.latex
            4: variable.parameter.function.latex
            5: punctuation.definition.brace.end.latex
          pop: true
        - include: frametitles
        - include: main

  frametitles:
    - match: '((\\)frametitle)(\{)(.*)(\})'
      scope: meta.function.frametitle.latex
      captures:
       1: support.function.frametitle.latex
       2: punctuation.definition.backslash.latex
       3: punctuation.definition.brace.begin.latex
       4: entity.name.function.frame.latex
       5: punctuation.definition.brace.end.latex
