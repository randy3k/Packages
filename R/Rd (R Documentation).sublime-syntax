%YAML 1.2
---
# http://www.sublimetext.com/docs/3/syntax.html
name: Rd (R Documentation)
file_extensions:
  - rd
scope: text.tex.latex.rd
contexts:
  prototype:
    - include: comments

  main:
    - include: stucture
    - include: r-code
    - include: equations
    # exteneded from latex
    - include: scope:text.tex.latex#invalid-quotations
    - include: scope:text.tex.latex#macros
    - include: global-braces
    - include: scope:text.tex.latex#general-constants
    - include: scope:text.tex.latex#general-commands

  comments:
    - include: scope:text.tex#comments

  global-braces:
    - match: '\{'
      scope: punctuation.definition.brace.begin.latex
      push:
        - meta_scope: meta.group.braces.latex
        - match: '\}'
          scope: punctuation.definition.brace.end.latex
          pop: true
        - include: main

  equations:
    - include: deqn
    - include: eqn

  deqn:
    - match: '((\\)(?:deqn))(\{)'
      captures:
        1: support.function.deqn.rd
        2: punctuation.definition.backslash.rd
        3: punctuation.definition.brace.begin.rd
      push:
        - meta_scope: meta.function.deqn.rd
        - meta_content_scope: meta.environment.math.latex
        - include: scope:text.tex.latex#math-content
        - match: '\}'
          scope: punctuation.definition.brace.end.rd
          pop: true

  eqn:
    - match: '((\\)(?:eqn))(\{)'
      captures:
        1: support.function.eqn.rd
        2: punctuation.definition.backslash.rd
        3: punctuation.definition.brace.begin.rd
      push:
        - meta_scope: meta.function.eqn.rd
        - meta_content_scope: meta.environment.math.latex
        - include: scope:text.tex.latex#math-content
        - match: '\}'
          scope: punctuation.definition.brace.end.rd
          pop: true

  r-code:
    - match: '((\\)(?:code))(\{)'
      captures:
        1: support.function.code.rd
        2: punctuation.definition.backslash.rd
        3: punctuation.definition.brace.begin.rd
      push:
        - meta_scope: meta.function.code.rd
        - meta_content_scope: source.r.embedded
        - match: '\}'
          scope: punctuation.definition.brace.end.rd
          pop: true
        - include: scope:source.r
    - match: '((\\)(?:Sexpr))(?:(\[)(?:[^\]]*)(\]))?(\{)'
      captures:
        1: support.function.sexpr.rd
        2: punctuation.definition.backslash.rd
        3: punctuation.definition.bracket.begin.rd
        4: punctuation.definition.bracket.end.rd
        5: punctuation.definition.brace.begin.rd
      push:
        - meta_scope: meta.function.sexpr.rd
        - meta_content_scope: source.r.embedded
        - match: '\}'
          scope: punctuation.definition.brace.end.rd
          pop: true
        - include: scope:source.r
    - match: '((\\)(?:usage))(\{)(?:\n)?'
      captures:
        1: support.function.usage.rd
        2: punctuation.definition.backslash.rd
        3: punctuation.definition.brace.begin.rd
      push:
        - meta_scope: meta.function.usage.rd
        - meta_content_scope: source.r.embedded
        - match: '\}'
          scope: punctuation.definition.brace.end.rd
          pop: true
        - include: scope:source.r
    - match: '((\\)(?:examples))(\{)(?:\n)?'
      captures:
        1: support.function.examples.rd
        2: punctuation.definition.backslash.rd
        3: punctuation.definition.brace.begin.rd
      push:
        - meta_scope: meta.function.examples.rd
        - meta_content_scope: source.r.embedded
        - match: '\}'
          scope: punctuation.definition.brace.end.rd
          pop: true
        - include: scope:source.r

  stucture:
    - match: '((\\)name)(\{)'
      captures:
        1: keyword.other.section.rd
        2: punctuation.definition.function.rd
        3: punctuation.definition.arguments.begin.rd
      push:
        - meta_scope: meta.section.rd
        - meta_content_scope: entity.name.function.rd
        - match: '(\})'
          captures:
            1: punctuation.definition.arguments.end.rd
          pop: true
        - include: main

    - match: '((\\)(?:alias|docType|keyword|title))(\{)'
      captures:
        1: keyword.other.section.rd
        2: punctuation.definition.function.rd
        3: punctuation.definition.arguments.begin.rd
      push:
        - meta_scope: meta.section.rd
        - match: '(\})'
          captures:
            1: punctuation.definition.arguments.end.rd
          pop: true
        - include: main
